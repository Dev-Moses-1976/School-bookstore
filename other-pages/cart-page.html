<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Your Cart</title>
    <link rel="stylesheet" href="../css/cart-page.css" />
    <script src="https://code.iconify.design/iconify-icon/2.3.0/iconify-icon.min.js"></script>
  </head>

  <body>
    <div class="first-content">
      <p class="active">SHOPPING CART</p>
      <iconify-icon
        icon="basil:caret-right-outline"
        width="32"
        height="32"
        class="iconify-icon"
      ></iconify-icon>
      <p>CHECKOUT DETAILS</p>
      <iconify-icon
        icon="basil:caret-right-outline"
        width="32"
        height="32"
        class="iconify-icon"
      ></iconify-icon>
      <p>ORDER COMPLETE</p>
    </div>

    <div class="first-maincontainer">
      <div class="sub-container1">
        <div class="head-container">
          <h4>PRODUCT</h4>
          <h4 class="price">PRICE</h4>
          <h4 class="quantity">QUANTITY</h4>
          <h4>SUBTOTAL</h4>
        </div>

        <div id="cart-page-items"></div>

        <div class="clicks">
          <div class="btn1">
            <button onclick="window.location.href='../index.html'">
              CONTINUE SHOPPING
            </button>
          </div>
          <div class="btn2">
            <button onclick="updateCart()">UPDATE CART</button>
          </div>
          <div class="btn3">
            <button>SHARE CART</button>
          </div>
        </div>
      </div>

      <div class="sub-container2">
        <h4>CART TOTALS</h4>
        <div class="subtotal">
          <p>Subtotal</p>
          <h4 id="cart-subtotal">₦0.00</h4>
        </div>

        <div class="shipping">
          <p>Shipping</p>
          <p class="paragraph2">Calculate Shipping</p>
        </div>

        <div class="total">
          <p>Total</p>
          <h4 id="cart-total">₦0.00</h4>
        </div>

        <div class="payment-method">
          <label for="options">Select Payment Method :</label>
          <select id="options" name="options">
            <option value="BANK TRANSFER">BANK TRANSFER</option>
            <option value="CARD PAYMENT">CARD PAYMENT</option>
          </select>
          <button onclick="proceedToCheckout()">PROCEED TO CHECKOUT</button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Retrieve cart items from localStorage
        const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
        const cartPageItemsElement = document.getElementById("cart-page-items");
        const cartSubtotalElement = document.getElementById("cart-subtotal");
        const cartTotalElement = document.getElementById("cart-total");

        // Function to update the cart display
        function updateCartDisplay() {
          // Clear the current cart items
          cartPageItemsElement.innerHTML = "";

          // Calculate the total price
          let total = 0;

          // Add each item to the cart display
          cartItems.forEach((item, index) => {
            const itemElement = document.createElement("div");
            itemElement.className = "inside-content";

            itemElement.innerHTML = `
            <div class="product">
              <button class="close-btn">
                <iconify-icon icon="stash:times-duotone" width="15" height="15" class="iconify-icon"></iconify-icon>
              </button>
              <img src="${
                item.image || "../images/computer-books/img13.jpg"
              }" alt="${item.name}">
              <p class="write-up">${item.name}</p>
            </div>
            <h3 class="amount2k" id="item-price">${item.price}</h3>
            <div class="btns">
              <button class="btn-1" onclick="cartDecreament()">-</button>
              <p id="demo"></p>
              <button class="btn-2" onclick="cartIncreament()">+</button>
            </div>
            <h3 id="item-price"></h3> 
            
          `;

            cartPageItemsElement.appendChild(itemElement);

            // Extract the price and add to the total
            const price = parseFloat(item.price.replace(/[^0-9.-]+/g, ""));
            total += price * (item.quantity || 1);
          });

          // Update the subtotal and total price
          cartSubtotalElement.textContent = `₦${item.price}`;
          cartTotalElement.textContent = `₦${item.price}`;
        }

        // Function to remove an item from the cart
        function removeItem(index) {
          const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
          cartItems.splice(index, 1);
          localStorage.setItem("cartItems", JSON.stringify(cartItems));
          updateCartDisplay();
        }

        // Function to increase item quantity
        function increaseQuantity(index) {
          const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
          cartItems[index].quantity = (cartItems[index].quantity || 1) + 1;
          localStorage.setItem("cartItems", JSON.stringify(cartItems));
          updateCartDisplay();
        }

        // Function to decrease item quantity
        function decreaseQuantity(index) {
          const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
          if (cartItems[index].quantity > 1) {
            cartItems[index].quantity -= 1;
            localStorage.setItem("cartItems", JSON.stringify(cartItems));
            updateCartDisplay();
          }
        }

        // Function to update the cart
        function updateCart() {
          alert("Cart updated!");
        }

        // Function to proceed to checkout
        function proceedToCheckout() {
          alert("Proceeding to checkout...");
        }

        // Initialize the cart display when the page loads
        updateCartDisplay();
      });

      //increament of cart and decreament of cart
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".inside-content").forEach((itemElement) => {
          let count = 0; // Individual item count

          const decrementBtn = itemElement.querySelector(".btn-1");
          const incrementBtn = itemElement.querySelector(".btn-2");
          const countDisplay = itemElement.querySelector("#demo");

          // Ensure count starts from 0 for each item
          countDisplay.textContent = count;

          // Increment function
          incrementBtn.addEventListener("click", function () {
            count++;
            countDisplay.textContent = count; // Update UI for this specific item
          });

          // Decrement function (prevents negative values)
          decrementBtn.addEventListener("click", function () {
            if (count > 0) {
              count--;
              countDisplay.textContent = count;
            }
          });
        });
      });

      //FUNCTION TO REMOVE BOOKS
      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".close-btn").forEach((button) => {
          button.addEventListener("click", function () {
            let itemToRemove = this.closest(".inside-content"); // Find closest cart item
            if (itemToRemove) {
              itemToRemove.remove(); // Remove only this specific item
            }
          });
        });
      });

      //Function INCREASE PRICE

      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll(".inside-content").forEach((itemElement) => {
          let count = 0; // Individual item count
          const priceElement = itemElement.querySelector("#item-price");
          const basePrice = parseFloat(
            priceElement.textContent.replace(/[^0-9.]/g, "")
          ); // Extract only numeric part
          const countDisplay = itemElement.querySelector("#demo");
          const decrementBtn = itemElement.querySelector(".btn-1");
          const incrementBtn = itemElement.querySelector(".btn-2");

          countDisplay.textContent = count; // Set initial count

          // Function to update price based on quantity
          function updatePrice() {
            priceElement.textContent = `$${(basePrice * count).toFixed(2)}`; // Update price dynamically
          }

          // Increment function
          incrementBtn.addEventListener("click", function () {
            count++;
            countDisplay.textContent = count;
            updatePrice(); // Update price
          });

          // Decrement function
          decrementBtn.addEventListener("click", function () {
            if (count > 0) {
              count--;
              countDisplay.textContent = count;
              updatePrice(); // Update price
            }
          });
        });
      });

      //TOTAL AND SUB TOTAL FUNCTIONALITIES

      document.addEventListener("DOMContentLoaded", function () {
        const cartSubtotalElement = document.getElementById("cart-subtotal");
        const cartTotalElement = document.getElementById("cart-total");

        function updateCartTotal() {
          let total = 0;

          document
            .querySelectorAll(".inside-content")
            .forEach((itemElement) => {
              const priceText =
                itemElement.querySelector("#item-price").textContent;
              const price = parseFloat(priceText.replace(/[^0-9.]/g, "")) || 0; // Extract numeric value, default to 0
              total += price;
            });

          // Update subtotal and total
          cartSubtotalElement.textContent = `₦${total.toFixed(2)}`;
          cartTotalElement.textContent = `₦${total.toFixed(2)}`;
        }

        document.querySelectorAll(".inside-content").forEach((itemElement) => {
          let count = 0;
          const priceElement = itemElement.querySelector("#item-price");
          const basePrice =
            parseFloat(priceElement.textContent.replace(/[^0-9.]/g, "")) || 0;
          const countDisplay = itemElement.querySelector("#demo");
          const decrementBtn = itemElement.querySelector(".btn-1");
          const incrementBtn = itemElement.querySelector(".btn-2");

          // Initially set count & price to 0
          countDisplay.textContent = count;
          priceElement.textContent = `₦0.00`;

          function updatePrice() {
            const newPrice = basePrice * count;
            priceElement.textContent = `₦${newPrice.toFixed(2)}`;
            updateCartTotal(); // Update subtotal & total
          }

          incrementBtn.addEventListener("click", function () {
            count++;
            countDisplay.textContent = count;
            updatePrice();
          });

          decrementBtn.addEventListener("click", function () {
            if (count > 0) {
              count--;
              countDisplay.textContent = count;
              updatePrice();
            }
          });
        });

        // Initial calculation
        updateCartTotal();
      });
    </script>
  </body>
</html>
